<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>frame</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</head>

<body>
    <div id="vc-template" class="align-middle hidden text-right p-1 font-noto-jp">
        <div class="bg-sky-200/50 px-3 mr-2 rounded-full shadow inline-block align-middle">Test</div>
        <img class="rounded-full inline shadow"
            src="https://cdn.discordapp.com/icons/442549986207596544/a_4d26de7c9984ef733532a153e499cebf.gif?size=4096"
            width="40" height="40" />
    </div>
    <div id="chat-template" class="align-middle hidden text-right p-1">
        <img class="rounded-full inline shadow align-middle my-1"
            src="https://cdn.discordapp.com/icons/442549986207596544/a_4d26de7c9984ef733532a153e499cebf.gif?size=4096"
            width="30" height="30" />
        <div
            class="bg-indigo-200/50 px-3 ml-1 rounded-t-xl rounded-bl-xl shadow inline-block align-middle text-left font-noto-jp">
            Test</div>
    </div>
    <div id="vc" class="text-[20px] absolute overflow-hidden right-0 p-4">
    </div>
    <div id="chat" class="text-[20px] absolute overflow-hidden bottom-60 right-0 pr-4 break-all w-[500px]">
    </div>
</body>
<script>
    nodecg.Replicant("vc").on("change", (newValue) => {
        const vcElem = document.getElementById("vc");
        let child = vcElem.lastElementChild;
        while (child) {
            vcElem.removeChild(child);
            child = vcElem.lastElementChild;
        }
        newValue.forEach((value) => {
            let tmpElem = document.getElementById("vc-template").cloneNode(true);
            tmpElem.classList.remove("hidden")
            tmpElem.id = "";
            if( value.avatar != ""){
                tmpElem.lastElementChild.src = value.avatar;
            }
            tmpElem.firstElementChild.innerText = value.name;
            if (value.speaking) {
                tmpElem.lastElementChild.classList.add("outline-emerald-500", "outline", "outline-2")
            }
            vcElem.appendChild(tmpElem);
        })
    });
    nodecg.Replicant("chat").on("change", (newValue) => {
        const chatElem = document.getElementById("chat");
        let tmpElem = document.getElementById("chat-template").cloneNode(true);
        tmpElem.classList.remove("hidden")
        tmpElem.id = "";
        if( value.avatar != ""){
            tmpElem.firstElementChild.src = newValue.avatar;
        }
        tmpElem.lastElementChild.innerText = newValue.content;
        const newelm = chatElem.appendChild(tmpElem);
        let tl = anime.timeline({
            easing: 'easeOutExpo',
            duration: 750,
        });
        tl.add({
            targets: newelm,
            opacity: [{ value: 0, duration: 0 }, { value: 1 }],
            translateX: [{ value: 100, duration: 0 }, { value: 0 }],
            duration: 1000,
        });
        tl.add({
            targets: newelm,
            opacity: 0,
            delay: 10000,
            translateX: 100,
            duration: 1000,
        })
        setTimeout(function () {
            chatElem.removeChild(newelm)
        }, 11000)
        if (chatElem.childNodes.length > 6) {
            chatElem.removeChild(chatElem.firstElementChild)
        }
    });
</script>
<style>
    .font {
        font-family: "Audiowide", cursive;
    }

    .font-jp {
        font-family: "M PLUS Rounded 1c", sans-serif;
    }

    .font-noto-jp {
        font-family: "Noto Sans JP", sans-serif;
    }
</style>

</html>